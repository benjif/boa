FIND_PROGRAM(GLSLC glslc)

FUNCTION(ADD_SHADER TARGET GLSL)
    GET_FILENAME_COMPONENT(FILE_NAME ${GLSL} NAME)
    SET(OUTPUT_PATH "${CMAKE_CURRENT_SOURCE_DIR}/shaders/out/${FILE_NAME}.spv")
    GET_FILENAME_COMPONENT(SPV_OUTPUT_PATH ${OUTPUT_PATH} DIRECTORY)
    FILE(MAKE_DIRECTORY ${SPV_OUTPUT_PATH})

    ADD_CUSTOM_COMMAND(
        OUTPUT ${OUTPUT_PATH}
        COMMAND ${GLSLC} -o ${OUTPUT_PATH} ${GLSL}
        DEPENDS ${GLSL}
        IMPLICIT_DEPENDS CXX ${GLSL}
        VERBATIM
    )

    SET_SOURCE_FILES_PROPERTIES(${OUTPUT_PATH} PROPERTIES GENERATED TRUE)
    TARGET_SOURCES(${TARGET} PRIVATE ${OUTPUT_PATH})
ENDFUNCTION(ADD_SHADER)
